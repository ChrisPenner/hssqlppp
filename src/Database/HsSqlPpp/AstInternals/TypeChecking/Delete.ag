{-
Copyright 2009 Jake Wheat

-}
{-
================================================================================

= delete

pretty simple, mainly just need to inject ids into the where part

-}

SEM Statement
    | Delete
        loc.tpe = Right $ Pseudo Void
        loc.statementType =
            do
            pt <- sequence $ getPlaceholderTypes @whr.annotatedTree
            return (pt,@returning.listType)
        loc.backTree = Delete @ann @table.tbAnnotatedTree @using.annotatedTree @whr.annotatedTree @returning.annotatedTree
        loc.catUpdates = []

        loc.lib =
            either (const @lhs.lib) id $ do
            a <- lmt (allAtts <$> @table.tbUType)
            lbUpdate @lhs.cat (LBIds "delete table attrs" (Just $ getName @table.annotatedTree) a) @lhs.lib
        whr.lib = @loc.lib
        returning.lib = @loc.lib
